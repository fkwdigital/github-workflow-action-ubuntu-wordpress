(()=>{var e={888:(e,r,t)=>{e.exports=t(610)},610:(e,r,t)=>{"use strict";var n=t(317).exec;var s=t(317).execSync;var o=t(896);var i=t(928);var c=o.access;var u=o.accessSync;var p=o.constants||o;var a=process.platform=="win32";var fileNotExists=function(e,r){c(e,p.F_OK,(function(e){r(!e)}))};var fileNotExistsSync=function(e){try{u(e,p.F_OK);return false}catch(e){return true}};var localExecutable=function(e,r){c(e,p.F_OK|p.X_OK,(function(e){r(null,!e)}))};var localExecutableSync=function(e){try{u(e,p.F_OK|p.X_OK);return true}catch(e){return false}};var commandExistsUnix=function(e,r,t){fileNotExists(e,(function(s){if(!s){var o=n("command -v "+r+" 2>/dev/null"+" && { echo >&1 "+r+"; exit 0; }",(function(e,r,n){t(null,!!r)}));return}localExecutable(e,t)}))};var commandExistsWindows=function(e,r,t){if(!/^(?!(?:.*\s|.*\.|\W+)$)(?:[a-zA-Z]:)?(?:(?:[^<>:"\|\?\*\n])+(?:\/\/|\/|\\\\|\\)?)+$/m.test(e)){t(null,false);return}var s=n("where "+r,(function(e){if(e!==null){t(null,false)}else{t(null,true)}}))};var commandExistsUnixSync=function(e,r){if(fileNotExistsSync(e)){try{var t=s("command -v "+r+" 2>/dev/null"+" && { echo >&1 "+r+"; exit 0; }");return!!t}catch(e){return false}}return localExecutableSync(e)};var commandExistsWindowsSync=function(e,r,t){if(!/^(?!(?:.*\s|.*\.|\W+)$)(?:[a-zA-Z]:)?(?:(?:[^<>:"\|\?\*\n])+(?:\/\/|\/|\\\\|\\)?)+$/m.test(e)){return false}try{var n=s("where "+r,{stdio:[]});return!!n}catch(e){return false}};var cleanInput=function(e){if(/[^A-Za-z0-9_\/:=-]/.test(e)){e="'"+e.replace(/'/g,"'\\''")+"'";e=e.replace(/^(?:'')+/g,"").replace(/\\'''/g,"\\'")}return e};if(a){cleanInput=function(e){var r=/[\\]/.test(e);if(r){var t='"'+i.dirname(e)+'"';var n='"'+i.basename(e)+'"';return t+":"+n}return'"'+e+'"'}}e.exports=function commandExists(e,r){var t=cleanInput(e);if(!r&&typeof Promise!=="undefined"){return new Promise((function(r,t){commandExists(e,(function(n,s){if(s){r(e)}else{t(n)}}))}))}if(a){commandExistsWindows(e,t,r)}else{commandExistsUnix(e,t,r)}};e.exports.sync=function(e){var r=cleanInput(e);if(a){return commandExistsWindowsSync(e,r)}else{return commandExistsUnixSync(e,r)}}},346:(e,r,t)=>{"use strict";var n=t(317).spawn;var s=t(23);var escapeSpaces=function(e){if(typeof e==="string"){return e.replace(/\b\s/g,"\\ ")}else{return e}};var escapeSpacesInOptions=function(e){["src","dest","include","exclude","excludeFirst"].forEach((function(r){var t=e[r];if(typeof t==="string"){e[r]=escapeSpaces(t)}else if(Array.isArray(t)===true){e[r]=t.map(escapeSpaces)}}));return e};e.exports=function(e,r){e=e||{};e=s._extend({},e);e=escapeSpacesInOptions(e);var t=e.platform||process.platform;var o=t==="win32";if(typeof e.src==="undefined"){throw new Error("'src' directory is missing from options")}if(typeof e.dest==="undefined"){throw new Error("'dest' directory is missing from options")}var i=e.dest;if(typeof e.host!=="undefined"){i=e.host+":"+e.dest}if(!Array.isArray(e.src)){e.src=[e.src]}var c=[].concat(e.src);c.push(i);var u=(e.args||[]).find((function(e){return e.match(/--chmod=/)}));if(o&&!u){c.push("--chmod=ugo=rwX")}if(typeof e.host!=="undefined"||e.ssh){c.push("--rsh");var p="ssh";if(typeof e.port!=="undefined"){p+=" -p "+e.port}if(typeof e.privateKey!=="undefined"){p+=" -i "+e.privateKey}if(typeof e.sshCmdArgs!=="undefined"){p+=" "+e.sshCmdArgs.join(" ")}c.push(p)}if(e.recursive===true){c.push("--recursive")}if(e.times===true){c.push("--times")}if(e.syncDest===true||e.deleteAll===true){c.push("--delete");c.push("--delete-excluded")}if(e.syncDestIgnoreExcl===true||e.delete===true){c.push("--delete")}if(e.dryRun===true){c.push("--dry-run");c.push("--verbose")}if(typeof e.excludeFirst!=="undefined"&&s.isArray(e.excludeFirst)){e.excludeFirst.forEach((function(e,r){c.push("--exclude="+e)}))}if(typeof e.include!=="undefined"&&s.isArray(e.include)){e.include.forEach((function(e,r){c.push("--include="+e)}))}if(typeof e.exclude!=="undefined"&&s.isArray(e.exclude)){e.exclude.forEach((function(e,r){c.push("--exclude="+e)}))}switch(e.compareMode){case"sizeOnly":c.push("--size-only");break;case"checksum":c.push("--checksum");break}if(typeof e.args!=="undefined"&&s.isArray(e.args)){c=[...new Set([...c,...e.args])]}c=[...new Set(c)];var noop=function(){};var a=e.onStdout||noop;var f=e.onStderr||noop;var l="rsync ";c.forEach((function(e){if(e.substr(0,4)==="ssh "){e='"'+e+'"'}l+=e+" "}));l=l.trim();if(e.noExec){r(null,null,null,l);return}try{var d="";var h="";var m;if(o){m=n("cmd.exe",["/s","/c",'"'+l+'"'],{windowsVerbatimArguments:true,stdio:[process.stdin,"pipe","pipe"]})}else{m=n("/bin/sh",["-c",l])}m.stdout.on("data",(function(e){a(e);d+=e}));m.stderr.on("data",(function(e){f(e);h+=e}));m.on("exit",(function(e){var t=null;if(e!==0){t=new Error("rsync exited with code "+e);t.code=e}r(t,d,h,l)}))}catch(e){r(e,null,null,l)}}},70:e=>{const r=["*~",".git",".github",".gitignore",".DS_Store",".svn",".cvs","*.bak","*.swp","Thumbs.db","*.log",".env",".smushit-status",".gitattributes","/db-config.php","/index.php","/wp-activate.php","/wp-admin/","/wp-app.php","/wp-atom.php","/wp-blog-header.php","/wp-comments-post.php","/wp-commentsrss2.php","/wp-config.php","/wp-content/advanced-cache.php","/wp-content/backup-db/","/wp-content/blogs.dir/","/wp-content/breeze-config/","/wp-content/cache/","/wp-content/drop-ins/","/wp-content/index.php","/wp-content/mu-plugins/","/wp-content/mysql.sql","/wp-content/object-cache.php","/wp-content/plugins/","/wp-content/themes/index.php","/wp-content/themes/twenty*","/wp-content/themes/variations/","/wp-content/upgrade*","/wp-content/uploads/","/wp-content/webp-express","/wp-content/wp-cache-config.php","/wp-cron.php","/wp-feed.php","/wp-includes/","/wp-links-opml.php","/wp-load.php","/wp-login.php","/wp-mail.php","/wp-pass.php","/wp-rdf.php","/wp-register.php","/wp-rss.php","/wp-rss2.php","/wp-salt.php","/wp-settings.php","/wp-signup.php","/wp-trackback.php","/xmlrpc.php"];e.exports={ALWAYS_EXCLUDE:r}},700:e=>{const r="-azvr --inplace --exclude='.*' --no-perms --no-times --delete-after";const t="public/";function fromEnv(e,r=""){const t=Object.prototype.hasOwnProperty.call(process.env,e);const n=t?process.env[e]:process.env[`INPUT_${e}`];return n===undefined||n===null||n===""?r:n}function ensureSlash(e){return e.endsWith("/")?e:`${e}/`}function getInputs(){return{host:fromEnv("REMOTE_HOST"),user:fromEnv("REMOTE_USER"),port:fromEnv("REMOTE_PORT","22"),key:fromEnv("SSH_PRIVATE_KEY"),keyName:fromEnv("DEPLOY_KEY_NAME","deploy_key"),remotePath:fromEnv("REMOTE_PATH"),source:fromEnv("SOURCE",t),rsyncArgs:fromEnv("ARGS")||fromEnv("RSYNC_ARGS",r),excludeFile:fromEnv("EXCLUDE_FILE",""),extraExclude:fromEnv("EXTRA_EXCLUDE","")}}function computeDest(e){if(!e.remotePath){throw new Error("REMOTE_PATH is required")}return ensureSlash(e.remotePath)}function assertRequired(e){const r=[];if(!e.host)r.push("REMOTE_HOST");if(!e.user)r.push("REMOTE_USER");if(!e.key)r.push("SSH_PRIVATE_KEY");if(!e.remotePath)r.push("REMOTE_PATH");if(r.length){throw new Error(`Missing required inputs: ${r.join(", ")}`)}}e.exports={getInputs:getInputs,computeDest:computeDest,assertRequired:assertRequired,ensureSlash:ensureSlash,DEFAULT_ARGS:r,DEFAULT_SOURCE:t}},317:e=>{"use strict";e.exports=require("child_process")},896:e=>{"use strict";e.exports=require("fs")},857:e=>{"use strict";e.exports=require("os")},928:e=>{"use strict";e.exports=require("path")},23:e=>{"use strict";e.exports=require("util")}};var r={};function __nccwpck_require__(t){var n=r[t];if(n!==undefined){return n.exports}var s=r[t]={exports:{}};var o=true;try{e[t](s,s.exports,__nccwpck_require__);o=false}finally{if(o)delete r[t]}return s.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t={};const n=__nccwpck_require__(928);const s=__nccwpck_require__(896);const o=__nccwpck_require__(857);const{exec:i}=__nccwpck_require__(317);const c=__nccwpck_require__(346);const{sync:u}=__nccwpck_require__(888);const{getInputs:p,computeDest:a,assertRequired:f}=__nccwpck_require__(700);const{ALWAYS_EXCLUDE:l}=__nccwpck_require__(70);function ensureRsync(){return new Promise(((e,r)=>{if(u("rsync")){e();return}i("sudo apt-get update && sudo apt-get --no-install-recommends install -y rsync",(t=>{if(t){r(new Error(`rsync install failed: ${t.message}`));return}e()}))}))}function readExcludeFile(e,r){if(!r)return[];const t=n.isAbsolute(r)?r:n.join(e,r);if(!s.existsSync(t))return[];return s.readFileSync(t,"utf8").split(/\r?\n/).map((e=>e.trim())).filter((e=>e&&!e.startsWith("#")))}function splitArgsPreserveQuotes(e){const r=(e||"").match(/(?:[^\s'"]+|'[^']*'|"[^"]*")+/g)||[];return r.map((e=>e.replace(/^'(.*)'$/,"$1").replace(/^"(.*)"$/,"$1")))}function validateDir(e){if(!s.existsSync(e))s.mkdirSync(e,{recursive:true})}function validateFile(e){if(!s.existsSync(e))s.writeFileSync(e,"",{encoding:"utf8",mode:384})}function addSshKey(e,r){const t=process.env.HOME||o.homedir();const i=n.join(t,".ssh");validateDir(i);validateFile(n.join(i,"known_hosts"));const c=n.join(i,r||"deploy_key");s.writeFileSync(c,e,{encoding:"utf8",mode:384});return c}async function main(){const e=p();f(e);const r=process.env.GITHUB_WORKSPACE||process.cwd();const t=`${e.user}@${e.host}:${a(e)}`;const s=n.posix.join(r,e.source.endsWith("/")?e.source:`${e.source}/`);const i=readExcludeFile(r,e.excludeFile);const u=(e.extraExclude||"").split(",").map((e=>e.trim())).filter(Boolean);const d=[...l,...i,...u];console.log(`[deploy] Source → ${s}`);console.log(`[deploy] Dest → ${t}`);console.log(`[deploy] Rsync → ${e.rsyncArgs}`);console.log(`[deploy] Excludes → ${d.length}`);const h=addSshKey(e.key,e.keyName);const m=process.env.HOME||o.homedir();validateDir(n.join(m,".ssh"));validateFile(n.join(m,".ssh","known_hosts"));await ensureRsync();c({src:s,dest:t,args:splitArgsPreserveQuotes(e.rsyncArgs),privateKey:h,port:e.port,excludeFirst:d,ssh:true,sshCmdArgs:["-o","StrictHostKeyChecking=no"],recursive:true},((e,r,t,n)=>{if(e){console.error("⚠️  [rsync] error:",e.message);console.error("stderr:",t||"");console.error("cmd:",n||"");process.abort();return}console.log("✅ [rsync] completed");if(r)console.log(r);process.exit(0)}))}main();module.exports=t})();